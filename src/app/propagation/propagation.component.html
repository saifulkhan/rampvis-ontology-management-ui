<div class="main-content">
  <div class="container-fluid">
    <!--
      Card VIS search
    -->
    <div class="card">
      <div class="card-header card-header-primary card-header-icon">
        <div class="card-icon">
          <mat-icon>insert_chart</mat-icon>
        </div>
        <h4 class="card-title">Propagation</h4>
      </div>

      <div class="card-body">
        <!-- Search vis function form-->
        <form [formGroup]="ontoVisSearchFormGroup" class="vis-search">
          <mat-form-field>
            <input
              matInput
              type="text"
              [(ngModel)]="searchOntoVisQuery"
              formControlName="ontoVisSearchQuery"
              [matAutocomplete]="autoCompVis"
              placeholder="Search VIS functions"
              #input1
              (keydown.enter)="onClickSearchOntoVis()"
            />
            <mat-autocomplete #autoCompVis="matAutocomplete" (optionSelected)="optionSelected(input1)">
              <mat-option *ngFor="let d of suggestedOntoVis" [value]="d.function">
                <span [innerHTML]="d.function | highlight: highlightOntoVisSearchSuggestion"></span>
              </mat-option>
            </mat-autocomplete>
          </mat-form-field>

          <!-- <button
            (click)="onClickSearchOntoVis()"
            [disabled]="!ontoVisSearchFormGroup.valid"
            class="btn btn-primary btn-round btn-fab float-right card-btn"
            type="submit"
          >
            <mat-icon>search</mat-icon>
          </button> -->

          <button
            mat-raised-button
            class="btn btn-primary"
            cdkFocusInitial
            (click)="onClickSearchOntoVis()"
            type="submit"
            [disabled]="!ontoVisSearchFormGroup.valid"
          >Search</button>

        </form>

        <!-- Example vis table-->
        <mat-card *ngIf="ontoVisSearchResult?.length">
          <mat-card-header>
            <mat-card-title>VIS Function</mat-card-title>
            <mat-card-subtitle></mat-card-subtitle>
          </mat-card-header>
          <app-onto-vis-table-b [data]="ontoVisSearchResult"> </app-onto-vis-table-b>
        </mat-card>

        <!-- Example data table-->
        <mat-card *ngIf="exampleOntoData?.length">
          <mat-card-header>
            <mat-card-title>Reference Data Streams</mat-card-title>
            <mat-card-subtitle></mat-card-subtitle>
          </mat-card-header>
          <app-onto-data-example [data]="exampleOntoData" (onChangeKeywords)="onUpdateKeywords($event)" (onChangeDataTypes)="onUpdateDataTypes($event)">
          </app-onto-data-example>
        </mat-card>

        <!-- Example links table-->
        <!--
        <mat-card *ngIf="exampleLinks?.length">
          <mat-card-header>
            <mat-card-title>Links</mat-card-title>
            <mat-card-subtitle></mat-card-subtitle>
          </mat-card-header>
          <app-onto-page-group [data]="exampleLinks"> </app-onto-page-group>
        </mat-card>
        -->

        <mat-accordion>
          <mat-expansion-panel [expanded]="false">

            <mat-expansion-panel-header>
              <mat-panel-title> </mat-panel-title>
              <mat-panel-description> </mat-panel-description>
            </mat-expansion-panel-header>

            <mat-card-header>
              <mat-card-title>Search Query</mat-card-title>
              <mat-card-subtitle></mat-card-subtitle>
            </mat-card-header>

            <!--Data search form-->
            <div class="row">
              <div class="col-md-9">
                <mat-card class="mat-card-data-search">
                  <!--
                  <mat-card-header>
                  <mat-card-title>Search Query</mat-card-title>
                  <mat-card-subtitle></mat-card-subtitle>
                  </mat-card-header>
                  -->

                  <form>
                    <mat-form-field>
                      <mat-label>Keywords (every stream)</mat-label>
                      <mat-chip-list #keywordChipList1 aria-label="Must have">
                        <mat-chip
                          *ngFor="let d of selectedKeywords1"
                          [selectable]="false"
                          [removable]="true"
                          (removed)="onClickRemoveKeyword1(d)"
                          [ngClass]="selectedKeywords[d]?.state ? 'keyword-select-color-' + selectedKeywords[d]?.state : 'keyword-select-color'"
                        >
                          {{ d }}
                          <mat-icon matChipRemove *ngIf="true">cancel</mat-icon>
                        </mat-chip>
                        <input
                          placeholder="..."
                          #keywordInput1
                          [formControl]="keywordInputCtrl1"
                          [matAutocomplete]="autoKeyword1"
                          [matChipInputFor]="keywordChipList1"
                          [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                          (matChipInputTokenEnd)="onEnterAddKeyword1($event)"
                        />
                      </mat-chip-list>
                      <mat-autocomplete #autoKeyword1="matAutocomplete" (optionSelected)="onInputKeyword1($event)">
                        <mat-option *ngFor="let d of filteredKeywords1$ | async" [value]="d">
                          {{ d }}
                        </mat-option>
                      </mat-autocomplete>
                    </mat-form-field>

                    <div class="row">
                      <div class="col-md-10">
                        <mat-form-field>
                          <mat-label>Keywords (in group)</mat-label>
                          <mat-chip-list #keywordChipList2 aria-label="May have">
                            <mat-chip
                              *ngFor="let d of selectedKeywords2"
                              [selectable]="false"
                              [removable]="true"
                              (removed)="onClickRemoveKeyword2(d)"
                              [ngClass]="selectedKeywords[d]?.state ? 'keyword-select-color-' + selectedKeywords[d]?.state : 'keyword-select-color'"
                            >
                              {{ d }}
                              <mat-icon matChipRemove *ngIf="true">cancel</mat-icon>
                            </mat-chip>
                            <input
                              placeholder="..."
                              #keywordInput2
                              [formControl]="keywordInputCtrl2"
                              [matAutocomplete]="autoKeyword2"
                              [matChipInputFor]="keywordChipList2"
                              [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                              (matChipInputTokenEnd)="onEnterAddKeyword2($event)"
                            />
                          </mat-chip-list>
                          <mat-autocomplete #autoKeyword2="matAutocomplete" (optionSelected)="onInputKeyword2($event)">
                            <mat-option *ngFor="let d of filteredKeywords2$ | async" [value]="d">
                              {{ d }}
                            </mat-option>
                          </mat-autocomplete>
                        </mat-form-field>
                      </div>
                      <div class="col-md-2">
                        <mat-form-field>
                          <mat-label>Minimum should match</mat-label>
                          <input matInput placeholder="" [(ngModel)]="minimumShouldMatch" name="minimumShouldMatch" />
                        </mat-form-field>
                      </div>
                    </div>

                    <mat-form-field>
                      <mat-label>Keywords (exclude)</mat-label>
                      <mat-chip-list #keywordChipList3 aria-label="Must not have">
                        <mat-chip
                          *ngFor="let d of selectedKeywords3"
                          [selectable]="false"
                          [removable]="true"
                          (removed)="onClickRemoveKeyword3(d)"
                          [ngClass]="selectedKeywords[d]?.state && 'keyword-select-color-' + selectedKeywords[d]?.state"
                        >
                          {{ d }}
                          <mat-icon matChipRemove *ngIf="true">cancel</mat-icon>
                        </mat-chip>
                        <input
                          placeholder="..."
                          #keywordInput3
                          [formControl]="keywordInputCtrl3"
                          [matAutocomplete]="autoKeyword3"
                          [matChipInputFor]="keywordChipList3"
                          [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                          (matChipInputTokenEnd)="onEnterAddKeyword3($event)"
                        />
                      </mat-chip-list>
                      <mat-autocomplete #autoKeyword3="matAutocomplete" (optionSelected)="onInputKeyword3($event)">
                        <mat-option *ngFor="let d of filteredKeywords3$ | async" [value]="d">
                          {{ d }}
                        </mat-option>
                      </mat-autocomplete>
                    </mat-form-field>

                    <mat-form-field>
                      <mat-label>Data type</mat-label>
                      <mat-chip-list #dataTypeChipList aria-label="Data type">
                        <mat-chip
                          *ngFor="let d of selectedDataTypes_"
                          [selectable]="false"
                          [removable]="true"
                          (removed)="onClickRemoveDataType(d)"
                          [ngClass]="selectedDataTypes[d]?.state && 'datatype-select-color-1'"
                        >
                          {{ d }}
                          <mat-icon matChipRemove *ngIf="true">cancel</mat-icon>
                        </mat-chip>
                        <input
                          placeholder="..."
                          #dataTypeInput
                          [formControl]="dataTypeInputCtrl"
                          [matAutocomplete]="autoDataType"
                          [matChipInputFor]="dataTypeChipList"
                          [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                          (matChipInputTokenEnd)="onEnterAddDataType($event)"
                        />
                      </mat-chip-list>
                      <mat-autocomplete #autoDataType="matAutocomplete" (optionSelected)="onInputDataType($event)">
                        <mat-option *ngFor="let d of filteredDataTypes$ | async" [value]="d">
                          {{ d }}
                        </mat-option>
                      </mat-autocomplete>
                    </mat-form-field>

                    <!-- <button mat-raised-button class="btn btn-primary" (click)="onClickSearchMatchingGroups()" type="submit" align="end">Search</button> -->
                    <mat-card-actions align="end">
                      <button mat-raised-button class="btn btn-primary" cdkFocusInitial (click)="onClickSearchMatchingGroups()" type="submit">Search</button>
                    </mat-card-actions>
                  </form>
                </mat-card>
              </div>
              <!--end col-md-9-->

              <div class="col-md-3">
                <mat-card>
                  <!--
                  <mat-card-header>
                  <mat-card-title>Ranking Parameters</mat-card-title>
                  <mat-card-subtitle></mat-card-subtitle>
                  </mat-card-header>
                  -->

                  <form>
                    <label id="cluster-algorithm-group-label">Assign weights for ranking</label>
                    <table cellspacing="0">
                      <tr>
                        <td>
                          <mat-form-field>
                            <mat-label>Keyword</mat-label>
                            <input matInput placeholder="" [(ngModel)]="keywordFieldWeight" name="keywordFieldWeight" />
                          </mat-form-field>
                        </td>
                        <td>
                          <mat-form-field>
                            <mat-label>Description</mat-label>
                            <input matInput placeholder="" [(ngModel)]="descriptionFieldWeight" name="descriptionFieldWeight" />
                          </mat-form-field>
                        </td>
                        <td>
                          <mat-form-field>
                            <mat-label>Endpoint</mat-label>
                            <input matInput placeholder="" [(ngModel)]="descriptionFieldWeight" name="descriptionFieldWeight" />
                          </mat-form-field>
                        </td>
                      </tr>
                    </table>

                    <label id="cluster-algorithm-group-label">Select a grouping algorithm</label>
                    <mat-radio-group
                      aria-labelledby="example-radio-group-label"
                      class="cluster-algorithm-radio-group"
                      [(ngModel)]="clusteringAlgorithm"
                      name="clusteringAlgorithm"
                    >
                      <mat-radio-button class="cluster-algorithm-radio-button" *ngFor="let d of clusteringAlgorithms" [value]="d">
                        {{ d }}
                      </mat-radio-button>
                    </mat-radio-group>
                  </form>
                </mat-card>
              </div>
            </div>
            <!--End- Data search form-->
          </mat-expansion-panel>
        </mat-accordion>

        <!-- Propagation button -->
        <!--
        <div class="row">
          <div class="col-md-1 offset-md-11">
            <button mat-raised-button class="btn btn-warning float-right" (click)="onClickPropagateAll()">
              Propagate All
            </button>
          </div>
        </div>
        -->

        <mat-card *ngIf="ontoDataMatchingGroups?.length">
          <mat-card-header>
            <mat-card-title>Discovered Data Streams</mat-card-title>
            <mat-card-subtitle></mat-card-subtitle>
          </mat-card-header>
          <app-onto-data-matched-table
            [data]="ontoDataMatchingGroups"
            (onClickPropagate)="onClickPropagate($event)"
            (onClickRemove)="onClickRemove($event)"
          >
          </app-onto-data-matched-table>
        </mat-card>

        <!-- Links page table -->
        <!--
        <mat-card *ngIf="ontoPageExtSearchGroups?.length">
          <mat-card-header>
            <mat-card-title>Links</mat-card-title>
            <mat-card-subtitle></mat-card-subtitle>
          </mat-card-header>
          <app-onto-page-ext-group-table
            [data]="ontoPageExtSearchGroups"
            (onClickPropagate)="onClickPropagateOntoDataSearchGroup($event)"
            (onClickRemove)="onClickRemoveOntoDataSearchGroup($event)"
          >
          </app-onto-page-ext-group-table>
        </mat-card>
        -->

      </div>
    </div>

    <!--End- Card search data-->
  </div>

  <!-- set loaderId to something that is different from "master" -->
  <ngx-ui-loader></ngx-ui-loader>

  <!--End container-fluid-->
</div>
<!--End main-content-->
